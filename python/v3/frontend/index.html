<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Heating System v3 - Dashboard</title>
    <link rel="stylesheet" href="static/css/style.css?v=24">
    <link rel="icon" type="image/x-icon" href="static/images/favicon.ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.4.47/css/materialdesignicons.min.css">
</head>
<body>
    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h1 class="sidebar-title">üåû Solar v3</h1>
            <button class="sidebar-toggle" id="sidebar-toggle">‚ò∞</button>
        </div>
        
        <nav class="sidebar-nav">
            <button class="sidebar-link active" data-tab="dashboard">
                <span class="sidebar-icon"><i class="mdi mdi-view-dashboard"></i></span>
                <span class="sidebar-text">Overview</span>
            </button>
            <button class="sidebar-link" data-tab="temperatures">
                <span class="sidebar-icon"><i class="mdi mdi-thermometer"></i></span>
                <span class="sidebar-text">Temperatures</span>
            </button>
            <button class="sidebar-link" data-tab="systems">
                <span class="sidebar-icon"><i class="mdi mdi-cog-outline"></i></span>
                <span class="sidebar-text">Systems</span>
            </button>
            <button class="sidebar-link" data-tab="control">
                <span class="sidebar-icon"><i class="mdi mdi-tune"></i></span>
                <span class="sidebar-text">Control</span>
            </button>
            <button class="sidebar-link" data-tab="diagnostics">
                <span class="sidebar-icon"><i class="mdi mdi-home-assistant"></i></span>
                <span class="sidebar-text">Home Assistant</span>
            </button>
        </nav>
        
        <div class="sidebar-footer">
            <div class="status-indicators">
                <div class="status-item" id="system-status">
                    <span class="status-label">System:</span>
                    <span class="status-value" id="system-mode">Loading...</span>
                </div>
                <div class="status-item" id="mqtt-status">
                    <span class="status-label">MQTT:</span>
                    <span class="status-value" id="mqtt-connection">Loading...</span>
                </div>
                <div class="status-item" id="ha-status">
                    <span class="status-label">HA:</span>
                    <span class="status-value" id="ha-connection">Loading...</span>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <!-- UX Fix #4: Hero Card for At-a-Glance Status -->
            <div class="hero-card">
                <div class="hero-content">
                    <div class="hero-main">
                        <div class="hero-status-section">
                            <h2 class="hero-title">System Status</h2>
                            <div class="hero-status-indicator" id="hero-status-indicator">
                                <span class="hero-dot status-active"></span>
                                <span class="hero-status-text" id="hero-status-text">Operating Normally</span>
                            </div>
                        </div>
                        
                        <div class="hero-metrics">
                            <div class="hero-metric">
                                <div class="metric-icon">üå°Ô∏è</div>
                                <div class="metric-content">
                                    <div class="metric-label">Tank Temperature</div>
                                    <div class="metric-value" id="hero-temp-tank">--¬∞C</div>
                                    <div class="metric-status" id="hero-temp-tank-status">--</div>
                                </div>
                            </div>
                            
                            <div class="hero-metric">
                                <div class="metric-icon">‚òÄÔ∏è</div>
                                <div class="metric-content">
                                    <div class="metric-label">Collector</div>
                                    <div class="metric-value" id="hero-temp-collector">--¬∞C</div>
                                    <div class="metric-status" id="hero-temp-collector-status">--</div>
                                </div>
                            </div>
                            
                            <div class="hero-metric">
                                <div class="metric-icon">üíß</div>
                                <div class="metric-content">
                                    <div class="metric-label">Pump</div>
                                    <div class="metric-value" id="hero-pump-status">OFF</div>
                                    <div class="metric-status" id="hero-pump-mode">Auto Mode</div>
                                </div>
                            </div>
                            
                            <div class="hero-metric">
                                <div class="metric-icon">‚ö°</div>
                                <div class="metric-content">
                                    <div class="metric-label">Energy Status</div>
                                    <div class="metric-value" id="hero-energy-status">Collecting</div>
                                    <div class="metric-status" id="hero-energy-detail">Solar heating active</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Energy Summary Card -->
            <div class="energy-summary-card">
                <div class="energy-summary-header">
                    <h3 class="energy-summary-title">‚ö° Energy Today</h3>
                    <div class="energy-total">
                        <span class="energy-total-label">Total:</span>
                        <span class="energy-total-value" id="energy-total">--</span>
                        <span class="energy-total-unit">kWh</span>
                    </div>
                </div>
                
                <div class="energy-sources-grid">
                    <!-- Solar Energy -->
                    <div class="energy-source solar">
                        <div class="energy-source-icon">‚òÄÔ∏è</div>
                        <div class="energy-source-content">
                            <div class="energy-source-label">Solar</div>
                            <div class="energy-source-values">
                                <div class="energy-source-daily">
                                    <span class="energy-value" id="energy-solar-daily">--</span>
                                    <span class="energy-unit">kWh</span>
                                </div>
                                <div class="energy-source-rate">
                                    <span class="energy-rate" id="energy-solar-rate">--</span>
                                    <span class="energy-rate-unit">kW/h</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Heater Energy -->
                    <div class="energy-source heater">
                        <div class="energy-source-icon">üî•</div>
                        <div class="energy-source-content">
                            <div class="energy-source-label">Heater</div>
                            <div class="energy-source-values">
                                <div class="energy-source-daily">
                                    <span class="energy-value" id="energy-heater-daily">--</span>
                                    <span class="energy-unit">kWh</span>
                                </div>
                                <div class="energy-source-rate">
                                    <span class="energy-rate" id="energy-heater-rate">--</span>
                                    <span class="energy-rate-unit">kW/h</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pellet Energy -->
                    <div class="energy-source pellet">
                        <div class="energy-source-icon">ü™µ</div>
                        <div class="energy-source-content">
                            <div class="energy-source-label">Pellets</div>
                            <div class="energy-source-values">
                                <div class="energy-source-daily">
                                    <span class="energy-value" id="energy-pellet-daily">--</span>
                                    <span class="energy-unit">kWh</span>
                                </div>
                                <div class="energy-source-rate">
                                    <span class="energy-rate" id="energy-pellet-rate">--</span>
                                    <span class="energy-rate-unit">kW/h</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-grid">
                <!-- System Overview -->
                <div class="card">
                    <h3>System Overview</h3>
                    <div class="system-info">
                        <div class="info-item">
                            <span class="label">Mode:</span>
                            <span class="value" id="current-mode">Auto</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Pump:</span>
                            <span class="value" id="pump-status">OFF</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Heater:</span>
                            <span class="value" id="heater-status">OFF</span>
                        </div>
                    </div>
                </div>

                <!-- Temperature Display -->
                <div class="card">
                    <h3>üå°Ô∏è Current Temperatures</h3>
                    <div class="temperature-grid">
                        <div class="temp-item">
                            <span class="temp-label">Tank:</span>
                            <span class="temp-value" id="temp-tank">--¬∞C</span>
                        </div>
                        <div class="temp-item">
                            <span class="temp-label">Collector:</span>
                            <span class="temp-value" id="temp-collector">--¬∞C</span>
                        </div>
                        <div class="temp-item">
                            <span class="temp-label">Ambient:</span>
                            <span class="temp-value" id="temp-ambient">--¬∞C</span>
                        </div>
                        <div class="temp-item">
                            <span class="temp-label">Heat Exchanger:</span>
                            <span class="temp-value" id="temp-heat-exchanger">--%</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Controls -->
                <div class="card">
                    <h3>‚ö° Quick Controls</h3>
                    
                    <!-- Pump Toggle Switch -->
                    <div class="toggle-control-container">
                        <div class="toggle-label">
                            <span class="toggle-label-text">üíß Primary Pump</span>
                            <label class="toggle-switch" for="pump-toggle">
                                <input type="checkbox" id="pump-toggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Heater Toggle Switch -->
                    <div class="heater-control-container">
                        <div class="heater-toggle-label">
                            <span class="heater-label-text">üî• Cartridge Heater</span>
                            <label class="toggle-switch" for="heater-toggle">
                                <input type="checkbox" id="heater-toggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <p class="heater-toggle-hint" id="heater-toggle-hint">Toggle to control heater</p>
                        
                        <!-- Lockout Timer Display -->
                        <div class="heater-lockout-timer" id="heater-lockout-timer">
                            <div class="lockout-timer-label">
                                <span class="lockout-timer-icon">‚è±Ô∏è</span>
                                Cooldown Active
                            </div>
                            <div class="lockout-timer-value" id="lockout-timer-countdown">0:05</div>
                        </div>
                    </div>
                </div>

                <!-- Mode Selection -->
                <div class="card">
                    <h3>üéõÔ∏è System Mode</h3>
                    <div class="mode-buttons">
                        <button class="btn btn-mode" data-mode="auto" id="mode-auto">Auto</button>
                        <button class="btn btn-mode" data-mode="manual" id="mode-manual">Manual</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Temperatures Tab -->
        <div id="temperatures" class="tab-content">
            <div class="card">
                <h3>üå°Ô∏è Temperature Monitoring</h3>
                <div class="temperature-details">
                    <div class="temp-card">
                        <h4>Water Tank</h4>
                        <div class="temp-display" id="temp-tank-detail">--¬∞C</div>
                        <div class="temp-status" id="tank-status">Normal</div>
                    </div>
                    <div class="temp-card">
                        <h4>Solar Collector</h4>
                        <div class="temp-display" id="temp-collector-detail">--¬∞C</div>
                        <div class="temp-status" id="collector-status">Normal</div>
                    </div>
                    <div class="temp-card">
                        <h4>Ambient</h4>
                        <div class="temp-display" id="temp-ambient-detail">--¬∞C</div>
                        <div class="temp-status" id="ambient-status">Normal</div>
                    </div>
                    <div class="temp-card">
                        <h4>üîÑ Heat Exchanger</h4>
                        <div class="temp-display efficiency-display" id="temp-heat-exchanger-detail">--%</div>
                        <div class="temp-status" id="heat-exchanger-status">Normal</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Control Tab - REDESIGNED as Status Monitoring View -->
        <div id="control" class="tab-content">
            <div class="card">
                <h3>üìä System Status & Details</h3>
                <p class="tab-description">Detailed system state and control history. Use Dashboard tab for controls.</p>
                
                <div class="control-section">
                    <h4>üíß Pump Status</h4>
                    <div class="status-detail-grid">
                        <div class="status-detail-item">
                            <span class="label">Current State:</span>
                            <span class="value status-badge" id="control-pump-status">OFF</span>
                        </div>
                        <div class="status-detail-item">
                            <span class="label">Control Mode:</span>
                            <span class="value" id="control-pump-mode">Automatic</span>
                        </div>
                        <div class="status-detail-item">
                            <span class="label">Runtime Today:</span>
                            <span class="value" id="pump-runtime">-- hours</span>
                        </div>
                        <div class="status-detail-item">
                            <span class="label">Last Changed:</span>
                            <span class="value" id="pump-last-change">--</span>
                        </div>
                    </div>
                </div>
                
                <div class="control-section">
                    <h4>‚öôÔ∏è System Mode Details</h4>
                    <div class="status-detail-grid">
                        <div class="status-detail-item">
                            <span class="label">Current Mode:</span>
                            <span class="value status-badge" id="control-current-mode">Auto</span>
                        </div>
                        <div class="status-detail-item">
                            <span class="label">Manual Control:</span>
                            <span class="value" id="control-manual-status">Disabled</span>
                        </div>
                        <div class="status-detail-item">
                            <span class="label">Auto Control Active:</span>
                            <span class="value" id="auto-control-active">Yes</span>
                        </div>
                        <div class="status-detail-item">
                            <span class="label">Mode Changed:</span>
                            <span class="value" id="mode-last-change">--</span>
                        </div>
                    </div>
                </div>
                
                <div class="control-section">
                    <h4>üî• Heater Status</h4>
                    <div class="status-detail-grid">
                        <div class="status-detail-item">
                            <span class="label">Current State:</span>
                            <span class="value status-badge" id="control-heater-status">OFF</span>
                        </div>
                        <div class="status-detail-item">
                            <span class="label">Runtime Today:</span>
                            <span class="value" id="heater-runtime">-- hours</span>
                        </div>
                        <div class="status-detail-item">
                            <span class="label">Energy Used:</span>
                            <span class="value" id="heater-energy">-- kWh</span>
                        </div>
                        <div class="status-detail-item">
                            <span class="label">Last Activated:</span>
                            <span class="value" id="heater-last-active">--</span>
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <p><strong>üí° Tip:</strong> To control the system, switch to the Dashboard tab where all controls are centrally located.</p>
                </div>
            </div>
        </div>

        <!-- Diagnostics Tab -->
        <div id="diagnostics" class="tab-content">
            <div class="card">
                <h3>üîß System Diagnostics</h3>
                <div class="diagnostics-grid">
                    <div class="diagnostic-item">
                        <h4>MQTT Status</h4>
                        <div class="status-display" id="mqtt-status-detail">
                            <span class="status-indicator" id="mqtt-indicator">‚óè</span>
                            <span class="status-text" id="mqtt-text">Loading...</span>
                        </div>
                        <div class="last-message" id="mqtt-last-message">
                            <strong>Last Message:</strong>
                            <div class="message-details" id="mqtt-message-details">No messages</div>
                        </div>
                    </div>
                    
                    <div class="diagnostic-item">
                        <h4>Hardware Status</h4>
                        <div class="hardware-status" id="hardware-status-detail">
                            <div class="hardware-item">
                                <span class="label">RTD Boards:</span>
                                <span class="value" id="rtd-status">Unknown</span>
                            </div>
                            <div class="hardware-item">
                                <span class="label">Relays:</span>
                                <span class="value" id="relay-status">Unknown</span>
                            </div>
                            <div class="hardware-item">
                                <span class="label">Sensors:</span>
                                <span class="value" id="sensor-status">Unknown</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="diagnostic-item">
                        <h4>Service Status</h4>
                        <div class="service-status" id="service-status-detail">
                            <div class="service-item">
                                <span class="label">Solar Heating:</span>
                                <span class="value" id="solar-service-status">Unknown</span>
                            </div>
                            <div class="service-item">
                                <span class="label">MQTT:</span>
                                <span class="value" id="mqtt-service-status">Unknown</span>
                            </div>
                            <div class="service-item">
                                <span class="label">Watchdog:</span>
                                <span class="value" id="watchdog-service-status">Unknown</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Systems Tab -->
        <div id="systems" class="tab-content">
            <div class="systems-grid">
                <!-- Solar Heating System Card -->
                <div class="system-card solar-card">
                    <div class="system-header">
                        <div class="system-icon">üåû</div>
                        <h3>Solar Heating System</h3>
                    </div>
                    <div class="system-metrics">
                        <div class="system-metric">
                            <span class="metric-label">Collector Temperature</span>
                            <span class="metric-value" id="sys-solar-collector">--¬∞C</span>
                        </div>
                        <div class="system-metric">
                            <span class="metric-label">Tank Temperature</span>
                            <span class="metric-value" id="sys-solar-tank">--¬∞C</span>
                        </div>
                        <div class="system-metric highlight">
                            <span class="metric-label">Temperature Difference (dT)</span>
                            <span class="metric-value" id="sys-solar-dt">--¬∞C</span>
                        </div>
                        <div class="system-metric">
                            <span class="metric-label">Pump Status</span>
                            <span class="metric-value status-badge" id="sys-solar-pump">OFF</span>
                        </div>
                        <div class="system-metric">
                            <span class="metric-label">Energy Today</span>
                            <span class="metric-value" id="sys-solar-energy">-- kWh</span>
                        </div>
                    </div>
                    <div class="system-visual">
                        <div class="solar-flow-indicator" id="sys-solar-flow">
                            <div class="flow-line"></div>
                            <div class="flow-arrow"></div>
                        </div>
                    </div>
                </div>

                <!-- Cartridge Heater Card -->
                <div class="system-card heater-card">
                    <div class="system-header">
                        <div class="system-icon">üî•</div>
                        <h3>Cartridge Heater</h3>
                    </div>
                    <div class="system-metrics">
                        <div class="system-metric">
                            <span class="metric-label">Status</span>
                            <span class="metric-value status-badge" id="sys-heater-status">OFF</span>
                        </div>
                        <div class="system-metric">
                            <span class="metric-label">Current Power</span>
                            <span class="metric-value" id="sys-heater-power">-- kW</span>
                        </div>
                        <div class="system-metric">
                            <span class="metric-label">Energy Today</span>
                            <span class="metric-value" id="sys-heater-energy-today">-- kWh</span>
                        </div>
                        <div class="system-metric">
                            <span class="metric-label">Runtime Today</span>
                            <span class="metric-value" id="sys-heater-runtime">-- hours</span>
                        </div>
                        <div class="system-metric">
                            <span class="metric-label">Rated Power</span>
                            <span class="metric-value">3.0 kW</span>
                        </div>
                    </div>
                    <div class="system-visual">
                        <div class="heater-power-bar">
                            <div class="power-bar-fill" id="sys-heater-bar"></div>
                        </div>
                    </div>
                </div>


                <!-- Water Heater Tank Card -->
                <div class="system-card tank-card">
                    <div class="system-header">
                        <div class="system-icon">üå°Ô∏è</div>
                        <h3>Water Heater Tank</h3>
                    </div>
                    <div class="system-metrics">
                        <div class="system-metric highlight">
                            <span class="metric-label">Stored Energy</span>
                            <span class="metric-value" id="sys-tank-energy">-- kWh</span>
                        </div>
                        <div class="system-metric">
                            <span class="metric-label">Tank Capacity</span>
                            <span class="metric-value">360 L</span>
                        </div>
                    </div>
                    <div class="system-visual">
                        <div class="tank-gradient">
                            <div class="tank-level" id="sys-tank-level-140">
                                <span class="tank-label">140cm</span>
                                <span class="tank-temp" id="sys-tank-140">--¬∞C</span>
                            </div>
                            <div class="tank-level" id="sys-tank-level-120">
                                <span class="tank-label">120cm</span>
                                <span class="tank-temp" id="sys-tank-120">--¬∞C</span>
                            </div>
                            <div class="tank-level" id="sys-tank-level-100">
                                <span class="tank-label">100cm</span>
                                <span class="tank-temp" id="sys-tank-100">--¬∞C</span>
                            </div>
                            <div class="tank-level" id="sys-tank-level-80">
                                <span class="tank-label">80cm</span>
                                <span class="tank-temp" id="sys-tank-80">--¬∞C</span>
                            </div>
                            <div class="tank-level" id="sys-tank-level-60">
                                <span class="tank-label">60cm</span>
                                <span class="tank-temp" id="sys-tank-60">--¬∞C</span>
                            </div>
                            <div class="tank-level" id="sys-tank-level-40">
                                <span class="tank-label">40cm</span>
                                <span class="tank-temp" id="sys-tank-40">--¬∞C</span>
                            </div>
                            <div class="tank-level" id="sys-tank-level-20">
                                <span class="tank-label">20cm</span>
                                <span class="tank-temp" id="sys-tank-20">--¬∞C</span>
                            </div>
                            <div class="tank-level" id="sys-tank-level-0">
                                <span class="tank-label">0cm</span>
                                <span class="tank-temp" id="sys-tank-0">--¬∞C</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- FTX Ventilation Card -->
                <div class="system-card ftx-card">
                    <div class="system-header">
                        <div class="system-icon">üí®</div>
                        <h3>FTX Ventilation</h3>
                    </div>
                    <div class="system-metrics">
                        <div class="system-metric highlight">
                            <span class="metric-label">Heat Recovery</span>
                            <span class="metric-value" id="sys-ftx-efficiency">--%</span>
                        </div>
                    </div>
                    <div class="system-visual ftx-simple">
                        <!-- Horizontal flow: Outdoor ‚Üí HX ‚Üí Supply -->
                        <div class="ftx-row-top">
                            <div class="ftx-temp cold-temp">
                                <div class="temp-label">Outdoor</div>
                                <div class="temp-value" id="sys-ftx-outdoor">--¬∞C</div>
                            </div>
                            <div class="ftx-arrow">‚Üí</div>
                            <div class="ftx-hx">
                                <div class="hx-icon">‚ö°</div>
                                <div class="hx-eff" id="sys-ftx-efficiency-inline">--%</div>
                            </div>
                            <div class="ftx-arrow">‚Üí</div>
                            <div class="ftx-temp warm-temp">
                                <div class="temp-label">Supply</div>
                                <div class="temp-value" id="sys-ftx-supply">--¬∞C</div>
                            </div>
                        </div>
                        
                        <!-- Horizontal flow: Exhaust ‚Üê HX ‚Üê Return -->
                        <div class="ftx-row-bottom">
                            <div class="ftx-temp cold-temp">
                                <div class="temp-label">Exhaust</div>
                                <div class="temp-value" id="sys-ftx-exhaust">--¬∞C</div>
                            </div>
                            <div class="ftx-arrow">‚Üê</div>
                            <div class="ftx-hx-placeholder"></div>
                            <div class="ftx-arrow">‚Üê</div>
                            <div class="ftx-temp warm-temp">
                                <div class="temp-label">Return</div>
                                <div class="temp-value" id="sys-ftx-return">--¬∞C</div>
                            </div>
                        </div>
                    </div>
                </div>



            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <div class="last-update">
                    <span class="label">Last Update:</span>
                    <span class="value" id="last-update">Never</span>
                </div>
                <div class="api-status">
                    <span class="label">API Status:</span>
                    <span class="value" id="api-status">Connected</span>
                </div>
            </div>
        </footer>
    </main>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading system data...</div>
    </div>

    <!-- Notification Toast -->
    <div id="notification-toast" class="notification-toast">
        <div class="toast-content">
            <span class="toast-icon">‚ÑπÔ∏è</span>
            <span class="toast-message" id="toast-message">Notification</span>
        </div>
    </div>

    <script src="static/js/dashboard.js?v=17"></script>
</body>
</html>
<!-- API endpoint reference for testing -->
<script>
    // API endpoint reference: /api/status
    console.log('API endpoint available: /api/status');
</script>
